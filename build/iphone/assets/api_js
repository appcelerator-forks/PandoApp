function contactServerByGet(e){var t=Ti.Network.createHTTPClient({timeout:5e3});return t.open("GET",e),t.send(),t}function contactServerByPost(e,t){var i=Ti.Network.createHTTPClient({timeout:5e3});return i.open("POST",e),i.send(t),i}function contactServerByPostImage(e,t){var i=Ti.Network.createHTTPClient({timeout:5e3});return i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.open("POST",e),i.send(t),i}function onErrorCallback(e){COMMON.createAlert("Error",e)}var API_DOMAIN="salesad.freejini.com.my",PANDO_DOMAIN="14.102.151.167",USER="pando",KEY="234g3245908b32ger35g628v293ad99d",updateProfileUrl="http://"+PANDO_DOMAIN+"/pando/api/updateProfile?user="+USER+"&key="+KEY,updateTokenUrl="http://"+PANDO_DOMAIN+"/pando/api/getDeviceInfo?user="+USER+"&key="+KEY,sendNotificationUrl="http://"+PANDO_DOMAIN+"/pando/main/push_notification",doLoginUrl="http://"+PANDO_DOMAIN+"/pando/api/doLogin?user="+USER+"&key="+KEY,doSignUpUrl="http://"+PANDO_DOMAIN+"/pando/api/doSignUp?user="+USER+"&key="+KEY,addItemUrl="http://"+PANDO_DOMAIN+"/pando/api/addItem?user="+USER+"&key="+KEY,addToItemResponseUrl="http://"+PANDO_DOMAIN+"/pando/api/addToItemResponse?user="+USER+"&key="+KEY,updateItemResponseUrl="http://"+PANDO_DOMAIN+"/pando/api/updateItemResponse?user="+USER+"&key="+KEY,sendMessageUrl="http://"+PANDO_DOMAIN+"/pando/api/sendMessage?user="+USER+"&key="+KEY,validateTransactionCodeUrl="http://"+PANDO_DOMAIN+"/pando/api/validateTransactionCode?user="+USER+"&key="+KEY,getItemListUrl="http://"+PANDO_DOMAIN+"/pando/api/getItemList?user="+USER+"&key="+KEY,getItemResponseByUidUrl="http://"+PANDO_DOMAIN+"/pando/api/getItemResponseByUid?user="+USER+"&key="+KEY,getFriendListUrl="http://"+PANDO_DOMAIN+"/pando/api/getFriendList?user="+USER+"&key="+KEY,APILoadingList=[{url:getItemListUrl,model:"items",checkId:"1"},{url:getItemResponseByUidUrl,model:"item_response",checkId:"2"},{url:getFriendListUrl,model:"friends",checkId:"3"}];exports.callByPost=function(e,onload,onerror){var deviceToken=Ti.App.Properties.getString("deviceToken");if(""!=deviceToken){var url=eval(e.url);console.log(url);var _result=contactServerByPost(url,e.params||{});_result.onload=function(){console.log("success callByPost"),console.log(this.responseText),onload&&onload(this.responseText)},_result.onerror=function(e){console.log("onerror "+url),API.callByPost(e,onload,onerror)}}},exports.callByPostImage=function(e,onload,onerror){var client=Ti.Network.createHTTPClient({timeout:5e3}),url=eval(e.url),_result=contactServerByPostImage(url,e.params||{});_result.onload=function(){console.log("success"),onload&&onload(this.responseText)},_result.onerror=function(e){console.log("onerror"),API.callByPostImage(e,onload)}},exports.updateNotificationToken=function(){var e=Ti.App.Properties.getString("deviceToken");if(""!=e){var t={};t.version=Ti.Platform.version,t.os=Ti.Platform.osname,t.model=Ti.Platform.model,t.macaddress=Ti.Platform.macaddress,t.token=e;var i=updateTokenUrl,o=contactServerByPost(i,t);o.onload=function(){},o.onerror=function(){}}},exports.sendNotification=function(e){var t={},i=Ti.App.Properties.getString("user_id")||0;t.message=e.message,t.to_id=e.to_id,t.u_id=i;var o=sendNotificationUrl+"?message="+e.message+"&to_id="+e.to_id+"&u_id="+i+"&target="+e.target,r=contactServerByGet(o);r.onload=function(e){console.log(e)},r.onerror=function(e){console.log(e)}},exports.loadAPIBySequence=function(e,t){if(t="undefined"==typeof t?0:t,t>=APILoadingList.length)return Ti.App.fireEvent("app:next_loading"),!1;var i=APILoadingList[t],o=Alloy.createCollection(i.model),r=Alloy.createCollection("updateChecker"),a="";if("item_response"==i.model||"friends"==i.model){var l=Ti.App.Properties.getString("user_id")||0;a="&u_id="+l;var n=r.getCheckerById(i.checkId,l),s=n.updated||"";if(!l)return t++,void API.loadAPIBySequence(e,t)}else var n=r.getCheckerById(i.checkId),s=n.updated||"";var d=i.url+"&last_updated="+s+a;console.log(d);var c=Ti.Network.createHTTPClient({onload:function(){console.log("apisequence"),console.log(this.responseText);var a=JSON.parse(this.responseText);if("Success"==a.status||"success"==a.status){var l=a.data;o.saveArray(l)}if(Ti.App.fireEvent("app:update_loading_text",{text:APILoadingList[t].model+" loading..."}),"item_response"==i.model||"friends"==i.model){var n=Ti.App.Properties.getString("user_id")||0;r.updateModule(APILoadingList[t].checkId,APILoadingList[t].model,Common.now(),n)}else r.updateModule(APILoadingList[t].checkId,APILoadingList[t].model,Common.now());t++,API.loadAPIBySequence(e,t)},onerror:function(i){console.log("loadAPIBySequence error"),console.log(i),API.loadAPIBySequence(e,t)},timeout:7e3});"android"==Ti.Platform.osname&&c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),c.open("POST",d),c.send()};