function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){var e=Titanium.UI.createOptionDialog({title:"Choose an image source...",options:["Camera","Photo Gallery","Cancel"],cancel:2});e.addEventListener("click",function(e){0==e.index?Titanium.Media.showCamera({success:function(e){s=Alloy.Globals.Navigator.open("image_preview",{media:e.media})},cancel:function(){},error:function(e){var t=Titanium.UI.createAlertDialog({title:"Camera"});t.setMessage(e.code==Titanium.Media.NO_CAMERA?"Device does not have camera":"Unexpected error: "+e.code),t.show()},allowImageEditing:!0,mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO],saveToPhotoGallery:!0}):1==e.index&&Titanium.Media.openPhotoGallery({success:function(e){s=Alloy.Globals.Navigator.open("image_preview",{media:e.media})},cancel:function(){},mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO]})}),e.show()}function t(){if(!c)return void Common.createAlert("Warning","Please upload the item photo");var e=Ti.App.Properties.getString("user_id"),t="android"==Ti.Platform.osname?r.item_image.toImage().media:r.item_image.toImage(),i=Ti.App.Properties.getString("longitude"),o=Ti.App.Properties.getString("latitude"),a={Filedata:t,owner_id:e,item_name:r.item_name.value,item_category:r.item_category.value,photoLoad:c,longitude:i,latitude:o};d.start(),API.callByPostImage({url:"addItemUrl",params:a},function(e){console.log(e);var t=JSON.parse(e);return"error"==t.status?(Common.createAlert("Error",t.data[0]),d.finish(),!1):(d.finish(),void Common.createAlert("Notificatin","Item Upload Successful",function(){r.win.close()}))})}function i(){r.win.close()}function o(){console.log(s);var e=s.getMedia();r.item_image.image=e,c=1}function a(){var e=Alloy.createController("_left_right"),o="Swipe left or right to select";e.generate_button(r.inner_box,o,t,i),e.generate_indicator(r.item_container),r.win.add(d.getView())}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="personal_upload",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var r=this,l={},n={};r.__views.win=Ti.UI.createWindow({backgroundColor:"#E4E6E1",titleAttributes:{color:"#eaebe6"},navBarHidden:"false",font:{fontFamily:"Lato-Regular"},barColor:"#75d0cb",id:"win",title:"Upload New Item"}),r.__views.win&&r.addTopLevelView(r.__views.win),r.__views.__alloyId63=Ti.UI.createScrollView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,contentHeight:Ti.UI.SIZE,contentWidth:Ti.UI.FILL,id:"__alloyId63"}),r.__views.win.add(r.__views.__alloyId63),r.__views.__alloyId64=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId64"}),r.__views.__alloyId63.add(r.__views.__alloyId64),r.__views.__alloyId65=Ti.UI.createView({layout:"vertical",width:Ti.UI.SIZE,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:10,id:"__alloyId65"}),r.__views.__alloyId64.add(r.__views.__alloyId65),r.__views.__alloyId66=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:24},text:"Item Upload",id:"__alloyId66"}),r.__views.__alloyId65.add(r.__views.__alloyId66),r.__views.item_container=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"0",left:10,right:10,bottom:"0",borderColor:"#d2d3ce",backgroundColor:"#f6f6f6",id:"item_container"}),r.__views.__alloyId63.add(r.__views.item_container),r.__views.inner_box=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:"0",id:"inner_box",backgroundColor:"#F2F4F5"}),r.__views.item_container.add(r.__views.inner_box),r.__views.__alloyId67=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:14},text:"Please upload your item photo",id:"__alloyId67"}),r.__views.inner_box.add(r.__views.__alloyId67),r.__views.item_image=Ti.UI.createImageView({preventDefaultImage:!0,id:"item_image",image:"/images/icons/icon_take_photo.png",top:"10",width:"50%"}),r.__views.inner_box.add(r.__views.item_image),e?r.addListener(r.__views.item_image,"click",e):n["$.__views.item_image!click!loadPhoto"]=!0,r.__views.item_name=Ti.UI.createTextField({height:40,borderColor:"#dfe0e4",borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,textAlign:Titanium.UI.TEXT_ALIGNMENT_LEFT,backgroundColor:"#ffffff",width:Titanium.UI.FILL,left:10,right:10,top:10,font:{fontFamily:"Lato-Regular"},id:"item_name",hintText:"Item name"}),r.__views.inner_box.add(r.__views.item_name),r.__views.item_category=Ti.UI.createTextField({height:40,borderColor:"#dfe0e4",borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,textAlign:Titanium.UI.TEXT_ALIGNMENT_LEFT,backgroundColor:"#ffffff",width:Titanium.UI.FILL,left:10,right:10,top:10,font:{fontFamily:"Lato-Regular"},id:"item_category",hintText:"Item category"}),r.__views.inner_box.add(r.__views.item_category),r.__views.__alloyId68=Ti.UI.createImageView({preventDefaultImage:!0,width:Ti.UI.FILL,height:Ti.UI.SIZE,image:"/images/shadow.png",left:"10",right:"10",id:"__alloyId68"}),r.__views.__alloyId63.add(r.__views.__alloyId68),l.destroy=function(){},_.extend(r,r.__views),arguments[0]||{};var s,d=Alloy.createController("loading"),c=0;a(),Ti.App.addEventListener("imagePreview: imageCallback",o),r.win.addEventListener("close",function(){Ti.App.fireEvent("personal:refresh"),r.destroy(),console.log("window close")}),n["$.__views.item_image!click!loadPhoto"]&&r.addListener(r.__views.item_image,"click",e),_.extend(r,l)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;