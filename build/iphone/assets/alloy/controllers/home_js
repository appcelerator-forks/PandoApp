function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(i){i||(E=new C(0,0,function(){},function(){5>lives&&e(),t()}));var o=new Date,r=Math.floor(o.getTime()/1e3)+1,a=v-r;if(a=Math.floor(a%w),a>0){var n=Math.floor(a/60),l=Math.floor(a-60*n);E.set(n,l)}E.running||E.start()}function t(){var e=new Date,t=Math.floor(e.getTime()/1e3),i=v-t-1,o=Math.ceil(i/w);lives=o>=0?5-o:5}function i(e,t){var i=Titanium.UI.createAnimation({opacity:0,duration:500});e.animate(i),i.addEventListener("complete",function(){console.log("call"),t&&t()})}function o(e){"undefined"!=typeof e.source.controller&&Alloy.Globals.Navigator.open(e.source.controller)}function r(){var e=Alloy.createCollection("user"),t=Alloy.createCollection("item_response"),i=e.getPoint(),o=t.getSpendPoint();console.log(i+"-"+o),S=i-o,f.point.text=S,console.log("latest point from d"+S)}function a(e){return S>=e?!0:!1}function n(){return lives?void Common.dialogTextfield(function(i){if(console.log("user point before check point"+S),!a(i))return void Common.createAlert("Message","Not enough point. Please try again later");if(!i)return void Common.createAlert("Message","Please insert your bid amount.");U=i||0,lives-=1,Ti.App.Properties.setString("lives",lives);var o=new Date,r=Math.floor(o.getTime()/1e3)+1;v=r>v?parseInt(r)+w:parseInt(v)+w,Ti.App.Properties.setString("estimate_time",v),e(1),T.play(),t(),L.ItemRemove(1),L.insetItem()}):void Common.createAlert("Message","No more lives. Please try again later")}function l(){return U=0,lives?(y.play(),L.ItemRemove(2),console.log("insert"),void L.insetItem()):void Common.createAlert("Message","No more lives. Please try again later")}function s(e){var t=Alloy.createCollection("updateChecker"),i=t.getCheckerById(1);i.updated||"",API.callByPost({url:"getItemListUrl",params:{last_updated:""}},function(i){var o=Alloy.createCollection("items"),r=JSON.parse(i),a=r.data||null;o.saveArray(a),t.updateModule(1,"items",Common.now()),e&&e()})}function d(e){console.log("c");var t=Alloy.createCollection("updateChecker"),i=Ti.App.Properties.getString("user_id"),o=t.getCheckerById(2,i);o.updated||"",API.callByPost({url:"getItemResponseByUidUrl",params:{last_updated:"",u_id:i}},function(o){var r=Alloy.createCollection("item_response"),a=JSON.parse(o),n=a.data||null;r.saveArray(n),t.updateModule(2,"item_response",Common.now(),i),e&&e()})}function c(){f.left_right_button.removeAllChildren();var e=Alloy.createController("_left_right"),t="Swipe left or right to select";e.generate_button(f.left_right_button,t,n,l)}function u(){r(),p.start(),s(function(){d(function(){var e=Alloy.createCollection("items");b=e.getData(),console.log(b.length),L=new A(b.length),L.init(),p.finish()})})}function h(){f.win.add(p.getView()),t(),r(),e(),Alloy.createController("_left_right");var i=f.label_no_more.rect;f.label_no_more.height=i.width}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var f=this,g={},I={};f.__views.win=Ti.UI.createWindow({backgroundColor:"#ebebeb",titleAttributes:{color:"#ffffff"},navBarHidden:"true",font:{fontFamily:"Lato-Regular"},id:"win",theme:"Theme.NoActionBar",title:"Home",fullscreen:"false"}),f.__views.win&&f.addTopLevelView(f.__views.win),f.__views.__alloyId18=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,id:"__alloyId18"}),f.__views.win.add(f.__views.__alloyId18),f.__views.__alloyId19=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,zIndex:"10",top:"0",backgroundImage:"/images/bg/menu_bar.png",id:"__alloyId19"}),f.__views.__alloyId18.add(f.__views.__alloyId19),f.__views.__alloyId20=Ti.UI.createView({layout:"horizontal",width:Ti.UI.SIZE,height:Ti.UI.SIZE,right:"0",top:"10",id:"__alloyId20"}),f.__views.__alloyId19.add(f.__views.__alloyId20),f.__views.__alloyId21=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:"20",controller:"friends",height:"40",width:"40",image:"/images/icons/icon_search.png",id:"__alloyId21"}),f.__views.__alloyId20.add(f.__views.__alloyId21),o?f.addListener(f.__views.__alloyId21,"click",o):I["$.__views.__alloyId21!click!navTo"]=!0,f.__views.__alloyId22=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:"20",controller:"manage_item",height:"40",width:"40",image:"/images/icons/icon_plus.png",id:"__alloyId22"}),f.__views.__alloyId20.add(f.__views.__alloyId22),o?f.addListener(f.__views.__alloyId22,"click",o):I["$.__views.__alloyId22!click!navTo"]=!0,f.__views.__alloyId23=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:"20",controller:"setting",height:"40",width:"40",image:"/images/icons/icon_more.png",id:"__alloyId23"}),f.__views.__alloyId20.add(f.__views.__alloyId23),o?f.addListener(f.__views.__alloyId23,"click",o):I["$.__views.__alloyId23!click!navTo"]=!0,f.__views.__alloyId24=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,top:"70",contentHeight:Ti.UI.SIZE,contentWidth:Ti.UI.FILL,id:"__alloyId24"}),f.__views.__alloyId18.add(f.__views.__alloyId24),f.__views.__alloyId25=Ti.UI.createView({height:"80",borderColor:"#323136",backgroundColor:"#fff",zIndex:"10",borderRadius:"40",borderWidth:"4",width:"80",right:"10",top:"10",id:"__alloyId25"}),f.__views.__alloyId24.add(f.__views.__alloyId25),f.__views.__alloyId26=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,top:5,left:5,right:5,bottom:5,id:"__alloyId26"}),f.__views.__alloyId25.add(f.__views.__alloyId26),f.__views.__alloyId27=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"POINT",top:"5",textAlign:"center",id:"__alloyId27"}),f.__views.__alloyId26.add(f.__views.__alloyId27),f.__views.point=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:30},id:"point",textAlign:"center"}),f.__views.__alloyId26.add(f.__views.point),f.__views.__alloyId28=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"0",id:"__alloyId28"}),f.__views.__alloyId24.add(f.__views.__alloyId28),f.__views.indicator=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"indicator"}),f.__views.__alloyId28.add(f.__views.indicator),f.__views.label_no_more=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"No more Item",id:"label_no_more"}),f.__views.indicator.add(f.__views.label_no_more),f.__views.item_container=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"item_container"}),f.__views.indicator.add(f.__views.item_container),f.__views.__alloyId29=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:Ti.UI.SIZE,horizontalWrap:"false",id:"__alloyId29"}),f.__views.__alloyId28.add(f.__views.__alloyId29),f.__views.__alloyId30=Ti.UI.createView({height:Ti.UI.SIZE,width:"50%",backgroundColor:"#f7941d",id:"__alloyId30"}),f.__views.__alloyId29.add(f.__views.__alloyId30),f.__views.__alloyId31=Ti.UI.createLabel({color:"#ffffff",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"Undo",top:"10",bottom:"10",textAlign:"center",id:"__alloyId31"}),f.__views.__alloyId30.add(f.__views.__alloyId31),f.__views.__alloyId32=Ti.UI.createView({height:Ti.UI.SIZE,width:"50%",backgroundColor:"#75d0cb",id:"__alloyId32"}),f.__views.__alloyId29.add(f.__views.__alloyId32),f.__views.__alloyId33=Ti.UI.createLabel({color:"#ffffff",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"Willing to Buy",top:"10",bottom:"10",textAlign:"center",id:"__alloyId33"}),f.__views.__alloyId32.add(f.__views.__alloyId33),f.__views.left_right_button=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:10,id:"left_right_button"}),f.__views.__alloyId28.add(f.__views.left_right_button),g.destroy=function(){},_.extend(f,f.__views),arguments[0]||{};var p=Alloy.createController("loading"),m=new Date,v=Ti.App.Properties.getString("estimate_time")||m.getTime()/1e3,w=20,y=Ti.Media.createSound({url:"/sound/bloop_x.wav"}),T=Ti.Media.createSound({url:"/sound/game-sound-correct.wav"});Alloy.createCollection("item_response");var A=Alloy.createCollection("items");Alloy.createCollection("message");var E,L,b=A.getData(),U=0,S=0,C=function(e,t,i,o){return{total_sec:60*e+t,timer:this.timer,running:!1,set:function(e,t){return this.total_sec=60*parseInt(e)+parseInt(t),this.time={m:e,s:t},this},start:function(){var e=this;return this.running=!0,this.timer=setInterval(function(){if(e.total_sec){e.total_sec--;var t=parseInt(e.total_sec/60),r=e.total_sec%60;10>t&&(t="0"+t),10>r&&(r="0"+r),e.time={m:t,s:r},i()}else e.stop(),o()},1e3),this},stop:function(){return clearInterval(this.timer),this.running=!1,this.time={m:0,s:0},this.total_sec=0,this}}},A=function(e){return{counter:e,set:function(e){return this.counter=parseInt(e),this},init:function(){if(console.log("total items number: "+this.counter),this.counter)f.item_container.removeAllChildren(),this.insetItem(),this.insetItem(),f.item_container.children[0].addEventListener("postlayout",function(){var e=f.item_container.children[0].rect;f.label_no_more.height=e.height});else{var e=f.item_container.rect;console.log(e.width);var t=f.UI.create("ImageView",{width:e.width,height:e.width,backgroundColor:"#75d0cb",image:"/images/default/item.png"});f.item_container.add(t)}return this},insetItem:function(){if(this.counter){var e=b[this.counter-1],t=f.UI.create("View",{id:e.id,owner_id:e.owner_id,classes:["wfill","hsize"]});console.log(e.item_name);var i=f.UI.create("Label",{classes:["wfill","hsize","padding"],text:e.item_name,color:"#ffffff"}),o=f.UI.create("View",{top:0,classes:["wfill","hsize","shadow"],zIndex:10}),r=f.UI.create("ImageView",{zIndex:this.counter,classes:["wfill"],height:"auto",id:e.id,owner_id:e.owner_id,item_name:e.item_name,owner_name:e.owner_name,owner_img_path:e.owner_img_path,image:e.img_path,defaultImage:"/images/default/item.png",zIndex:1});o.add(i),t.add(r),t.add(o),this.counter--,f.item_container.add(t)}else console.log("no more");return this},ItemRemove:function(e){1!=f.item_container.children[0].zIndex;var t=Ti.App.Properties.getString("user_id"),o=f.item_container.children[0];API.callByPost({url:"addToItemResponseUrl",params:{point:U,item_id:o.id,owner_id:o.owner_id,requestor_id:t,actions:e}},function(e){var t=JSON.parse(e),i=Alloy.createCollection("item_response");"success"==t.status&&(console.log("item response save"),console.log(t.data),i.saveRecord(t.data),r())}),i(f.item_container.children[0],function(){var t=Alloy.createCollection("user_items");t.markRead({id:f.item_container.children[0].id,action:e}),f.item_container.remove(f.item_container.children[0])})},displayCurrentItemInfo:function(e){e=e||0;var t=f.item_container.children[e].item_name,i=f.item_container.children[e].owner_name,o=f.item_container.children[e].owner_img_path;f.item_name.text=t,f.owner_name.text=i,f.owner_img_path.image=o},resetCurrentItemInfo:function(){f.item_name.text="",f.owner_name.text="",f.owner_img_path.image=""}}};h(),Ti.App.addEventListener("home:refresh",u),Ti.App.addEventListener("home:leftright_refresh",c),f.win.addEventListener("close",function(){Ti.App.removeEventListener("home:refresh",u),f.destroy(),console.log("window close")}),I["$.__views.__alloyId21!click!navTo"]&&f.addListener(f.__views.__alloyId21,"click",o),I["$.__views.__alloyId22!click!navTo"]&&f.addListener(f.__views.__alloyId22,"click",o),I["$.__views.__alloyId23!click!navTo"]&&f.addListener(f.__views.__alloyId23,"click",o),_.extend(f,g)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;