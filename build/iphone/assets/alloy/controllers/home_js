function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(i){i||(L=new x(0,0,function(){I.time.text=L.time.m+":"+L.time.s},function(){5>v&&e(),t()}));var o=new Date,r=Math.floor(o.getTime()/1e3)+1,a=w-r;if(a=Math.floor(a%y),a>0){var n=Math.floor(a/60),l=Math.floor(a-60*n);L.set(n,l)}L.running||L.start()}function t(){var e=new Date,t=Math.floor(e.getTime()/1e3),i=w-t-1,o=Math.ceil(i/y);v=o>=0?5-o:5,I.life.text=v}function i(e,t){var i=Titanium.UI.createAnimation({opacity:0,duration:500});e.animate(i),i.addEventListener("complete",function(){console.log("call"),t&&t()})}function o(e){"undefined"!=typeof e.source.controller&&Alloy.Globals.Navigator.open(e.source.controller)}function r(){var e=Alloy.createCollection("user"),t=Alloy.createCollection("item_response"),i=e.getPoint(),o=t.getSpendPoint();console.log(i+"-"+o),C=i-o,I.point.text=C,console.log("latest point from d"+C)}function a(e){return C>=e?!0:!1}function n(){return E.counter?v?void Common.dialogTextfield(function(i){if(console.log("user point before check point"+C),!a(i))return void Common.createAlert("Message","Not enough point. Please try again later");if(!i)return void Common.createAlert("Message","Please insert your bid amount.");S=i||0,v-=1,Ti.App.Properties.setString("lives",v),I.life.text=v;var o=new Date,r=Math.floor(o.getTime()/1e3)+1;w=r>w?parseInt(r)+y:parseInt(w)+y,Ti.App.Properties.setString("estimate_time",w),e(1),A.play(),t(),b.ItemRemove(1),b.insetItem()}):void Common.createAlert("Message","No more lives. Please try again later"):void Common.createAlert("Message","No more item. Please try again later")}function l(){return S=0,E.counter?v?(T.play(),b.ItemRemove(2),console.log("insert"),void b.insetItem()):void Common.createAlert("Message","No more lives. Please try again later"):void Common.createAlert("Message","No more item. Please try again later")}function s(e){var t=Alloy.createCollection("updateChecker"),i=t.getCheckerById(1);i.updated||"",API.callByPost({url:"getItemListUrl",params:{last_updated:""}},function(i){var o=Alloy.createCollection("items"),r=JSON.parse(i),a=r.data||null;o.saveArray(a),t.updateModule(1,"items",Common.now()),e&&e()})}function d(e){console.log("c");var t=Alloy.createCollection("updateChecker"),i=Ti.App.Properties.getString("user_id"),o=t.getCheckerById(2,i);o.updated||"",API.callByPost({url:"getItemResponseByUidUrl",params:{last_updated:"",u_id:i}},function(o){var r=Alloy.createCollection("item_response"),a=JSON.parse(o),n=a.data||null;r.saveArray(n),t.updateModule(2,"item_response",Common.now(),i),e&&e()})}function c(){I.left_right_button.removeAllChildren();var e=Alloy.createController("_left_right"),t="Swipe left or right to select";e.generate_button(I.left_right_button,t,n,l)}function h(){r(),m.start(),s(function(){d(function(){var e=Alloy.createCollection("items");U=e.getData(),console.log(U.length),b=new E(U.length),b.init(),m.finish()})})}function u(){I.win.add(m.getView()),t(),r(),I.life.text=v,e();var i=Alloy.createController("_left_right"),o="Swipe left or right to select";i.generate_button(I.left_right_button,o,n,l);var a=I.label_no_more.rect;console.log(a.width),I.label_no_more.height=a.width}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var I=this,g={},f={};I.__views.win=Ti.UI.createWindow({backgroundColor:"#E4E6E1",titleAttributes:{color:"#eaebe6"},navBarHidden:"true",font:{fontFamily:"Lato-Regular"},id:"win",theme:"Theme.NoActionBar",title:"Home",fullscreen:"false"}),I.__views.win&&I.addTopLevelView(I.__views.win),I.__views.__alloyId19=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,id:"__alloyId19"}),I.__views.win.add(I.__views.__alloyId19),I.__views.__alloyId20=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,backgroundImage:"/images/bg/menu_bar.png",id:"__alloyId20"}),I.__views.__alloyId19.add(I.__views.__alloyId20),I.__views.__alloyId21=Ti.UI.createImageView({preventDefaultImage:!0,top:"20",left:"10",right:10,bottom:"20",height:"40",width:"40",image:"/images/icons/icon_referesh.png",id:"__alloyId21"}),I.__views.__alloyId20.add(I.__views.__alloyId21),h?I.addListener(I.__views.__alloyId21,"click",h):f["$.__views.__alloyId21!click!refresh"]=!0,I.__views.__alloyId22=Ti.UI.createView({layout:"horizontal",width:Ti.UI.SIZE,height:Ti.UI.SIZE,right:"0",top:"10",id:"__alloyId22"}),I.__views.__alloyId20.add(I.__views.__alloyId22),I.__views.__alloyId23=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:"20",controller:"friends",height:"40",width:"40",image:"/images/icons/icon_friends.png",id:"__alloyId23"}),I.__views.__alloyId22.add(I.__views.__alloyId23),o?I.addListener(I.__views.__alloyId23,"click",o):f["$.__views.__alloyId23!click!navTo"]=!0,I.__views.__alloyId24=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:"20",controller:"personal",height:"40",width:"40",image:"/images/icons/icon_upload.png",id:"__alloyId24"}),I.__views.__alloyId22.add(I.__views.__alloyId24),o?I.addListener(I.__views.__alloyId24,"click",o):f["$.__views.__alloyId24!click!navTo"]=!0,I.__views.__alloyId25=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:"20",controller:"setting",height:"40",width:"40",image:"/images/icons/icon_setting.png",id:"__alloyId25"}),I.__views.__alloyId22.add(I.__views.__alloyId25),o?I.addListener(I.__views.__alloyId25,"click",o):f["$.__views.__alloyId25!click!navTo"]=!0,I.__views.__alloyId26=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,contentHeight:Ti.UI.SIZE,contentWidth:Ti.UI.FILL,id:"__alloyId26"}),I.__views.__alloyId19.add(I.__views.__alloyId26),I.__views.__alloyId27=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId27"}),I.__views.__alloyId26.add(I.__views.__alloyId27),I.__views.__alloyId28=Ti.UI.createView({layout:"horizontal",width:Ti.UI.SIZE,height:Ti.UI.SIZE,borderColor:"#d2d3ce",backgroundColor:"#fff",left:"10",right:"10",bottom:"10",id:"__alloyId28"}),I.__views.__alloyId27.add(I.__views.__alloyId28),I.__views.__alloyId29=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,top:5,left:5,right:5,bottom:5,width:"60",id:"__alloyId29"}),I.__views.__alloyId28.add(I.__views.__alloyId29),I.__views.__alloyId30=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"LIFE",left:"0",textAlign:"right",id:"__alloyId30"}),I.__views.__alloyId29.add(I.__views.__alloyId30),I.__views.life=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:30},text:"0",id:"life"}),I.__views.__alloyId29.add(I.__views.life),I.__views.__alloyId31=Ti.UI.createView({width:"1",height:"50",backgroundColor:"#d2d3ce",id:"__alloyId31"}),I.__views.__alloyId28.add(I.__views.__alloyId31),I.__views.__alloyId32=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,top:5,left:5,right:5,bottom:5,width:"120",id:"__alloyId32"}),I.__views.__alloyId28.add(I.__views.__alloyId32),I.__views.__alloyId33=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"TIME",left:"0",textAlign:"right",id:"__alloyId33"}),I.__views.__alloyId32.add(I.__views.__alloyId33),I.__views.time=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:30},text:"00:00",id:"time"}),I.__views.__alloyId32.add(I.__views.time),I.__views.__alloyId34=Ti.UI.createView({height:Ti.UI.SIZE,borderColor:"#d2d3ce",backgroundColor:"#fff",width:"auto",right:"10",bottom:"10",id:"__alloyId34"}),I.__views.__alloyId27.add(I.__views.__alloyId34),I.__views.__alloyId35=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,top:5,left:5,right:5,bottom:5,id:"__alloyId35"}),I.__views.__alloyId34.add(I.__views.__alloyId35),I.__views.__alloyId36=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"POINT",left:"0",textAlign:"right",id:"__alloyId36"}),I.__views.__alloyId35.add(I.__views.__alloyId36),I.__views.point=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:30},id:"point"}),I.__views.__alloyId35.add(I.__views.point),I.__views.__alloyId37=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"0",left:10,right:10,bottom:"0",borderColor:"#d2d3ce",backgroundColor:"#f6f6f6",id:"__alloyId37"}),I.__views.__alloyId26.add(I.__views.__alloyId37),I.__views.__alloyId38=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId38"}),I.__views.__alloyId37.add(I.__views.__alloyId38),I.__views.indicator=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"indicator"}),I.__views.__alloyId37.add(I.__views.indicator),I.__views.label_no_more=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"No more Item",id:"label_no_more"}),I.__views.indicator.add(I.__views.label_no_more),I.__views.item_container=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"item_container",left:"10",top:"10",right:"10"}),I.__views.indicator.add(I.__views.item_container),I.__views.left_right_button=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:10,id:"left_right_button"}),I.__views.__alloyId37.add(I.__views.left_right_button),I.__views.__alloyId39=Ti.UI.createImageView({preventDefaultImage:!0,width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"0",left:10,right:10,bottom:10,image:"/images/shadow.png",id:"__alloyId39"}),I.__views.__alloyId26.add(I.__views.__alloyId39),g.destroy=function(){},_.extend(I,I.__views),arguments[0]||{};var m=Alloy.createController("loading"),p=new Date,v=Ti.App.Properties.getString("lives")||5,w=Ti.App.Properties.getString("estimate_time")||p.getTime()/1e3,y=20,T=Ti.Media.createSound({url:"/sound/bloop_x.wav"}),A=Ti.Media.createSound({url:"/sound/game-sound-correct.wav"});Alloy.createCollection("item_response");var E=Alloy.createCollection("items");Alloy.createCollection("message");var L,b,U=E.getData(),S=0,C=0,x=function(e,t,i,o){return{total_sec:60*e+t,timer:this.timer,running:!1,set:function(e,t){return this.total_sec=60*parseInt(e)+parseInt(t),this.time={m:e,s:t},this},start:function(){var e=this;return this.running=!0,this.timer=setInterval(function(){if(e.total_sec){e.total_sec--;var t=parseInt(e.total_sec/60),r=e.total_sec%60;10>t&&(t="0"+t),10>r&&(r="0"+r),e.time={m:t,s:r},i()}else e.stop(),o()},1e3),this},stop:function(){return clearInterval(this.timer),this.running=!1,this.time={m:0,s:0},this.total_sec=0,this}}},E=function(e){return{counter:e,set:function(e){return this.counter=parseInt(e),this},init:function(){if(console.log("total items number: "+this.counter),this.counter)I.item_container.removeAllChildren(),this.insetItem(),this.insetItem(),I.item_container.children[0].addEventListener("postlayout",function(){var e=I.item_container.children[0].rect;I.label_no_more.height=e.height});else{var e=I.item_container.rect;console.log(e.width);var t=I.UI.create("ImageView",{classes:["box"],width:e.width,height:e.width,image:"/images/default/item.png"});I.item_container.add(t)}return this},insetItem:function(){if(this.counter){var e=U[this.counter-1],t=I.UI.create("View",{id:e.id,owner_id:e.owner_id,classes:["wfill","hsize"]});console.log(e.item_name);var i=I.UI.create("Label",{classes:["wfill","hsize","padding"],text:e.item_name,color:"#ffffff"}),o=I.UI.create("View",{top:0,classes:["wfill","hsize","shadow"],zIndex:10}),r=I.UI.create("ImageView",{zIndex:this.counter,classes:["wfill"],height:"auto",id:e.id,owner_id:e.owner_id,item_name:e.item_name,owner_name:e.owner_name,owner_img_path:e.owner_img_path,image:e.img_path,defaultImage:"/images/default/item.png",zIndex:1});o.add(i),t.add(r),t.add(o),this.counter--,I.item_container.add(t)}else console.log("no more");return this},ItemRemove:function(e){1!=I.item_container.children[0].zIndex;var t=Ti.App.Properties.getString("user_id"),o=I.item_container.children[0];API.callByPost({url:"addToItemResponseUrl",params:{point:S,item_id:o.id,owner_id:o.owner_id,requestor_id:t,actions:e}},function(e){var t=JSON.parse(e),i=Alloy.createCollection("item_response");"success"==t.status&&(console.log("item response save"),console.log(t.data),i.saveRecord(t.data),r())}),i(I.item_container.children[0],function(){var t=Alloy.createCollection("user_items");t.markRead({id:I.item_container.children[0].id,action:e}),I.item_container.remove(I.item_container.children[0])})},displayCurrentItemInfo:function(e){e=e||0;var t=I.item_container.children[e].item_name,i=I.item_container.children[e].owner_name,o=I.item_container.children[e].owner_img_path;I.item_name.text=t,I.owner_name.text=i,I.owner_img_path.image=o},resetCurrentItemInfo:function(){I.item_name.text="",I.owner_name.text="",I.owner_img_path.image=""}}};u(),Ti.App.addEventListener("home:refresh",h),Ti.App.addEventListener("home:leftright_refresh",c),I.win.addEventListener("close",function(){Ti.App.removeEventListener("home:refresh",h),I.destroy(),console.log("window close")}),f["$.__views.__alloyId21!click!refresh"]&&I.addListener(I.__views.__alloyId21,"click",h),f["$.__views.__alloyId23!click!navTo"]&&I.addListener(I.__views.__alloyId23,"click",o),f["$.__views.__alloyId24!click!navTo"]&&I.addListener(I.__views.__alloyId24,"click",o),f["$.__views.__alloyId25!click!navTo"]&&I.addListener(I.__views.__alloyId25,"click",o),_.extend(I,g)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;