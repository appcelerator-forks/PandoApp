function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(t){t||(E=new C(0,0,function(){},function(){5>lives&&e(),refreshLife()}));var i=new Date,o=Math.floor(i.getTime()/1e3)+1,r=v-o;if(r=Math.floor(r%y),r>0){var a=Math.floor(r/60),n=Math.floor(r-60*a);E.set(a,n)}E.running||E.start()}function t(e,t){var i=Titanium.UI.createAnimation({opacity:0,duration:500});e.animate(i),i.addEventListener("complete",function(){t&&t()})}function i(){var e=Ti.Platform.displayCaps.platformWidth;f.left_right_button.top=e+40}function o(e){"undefined"!=typeof e.source.controller&&Alloy.Globals.Navigator.open(e.source.controller)}function r(){var e=Alloy.createCollection("user"),t=Alloy.createCollection("item_response"),i=e.getPoint(),o=t.getSpendPoint();S=i-o,f.point.text=S}function a(e){return S>=e?!0:!1}function n(t){Common.dialogTextfield(function(i){if(!a(i))return void Common.createAlert("Message","Not enough point. Please try again later");if(!i)return void Common.createAlert("Message","Please insert your bid amount.");U=i||0;var o=new Date,r=Math.floor(o.getTime()/1e3)+1;v=r>v?parseInt(r)+y:parseInt(v)+y,Ti.App.Properties.setString("estimate_time",v),e(1),T.play(),L.ItemRemove(1,t),L.insetItem()})}function l(e){U=0,w.play(),L.ItemRemove(2,e),L.insetItem()}function s(e){var t=Alloy.createCollection("updateChecker"),i=t.getCheckerById(1);i.updated||"",API.callByPost({url:"getItemListUrl",params:{last_updated:""}},function(i){var o=Alloy.createCollection("items"),r=JSON.parse(i),a=r.data||null;o.saveArray(a),t.updateModule(1,"items",Common.now()),e&&e()})}function d(e){var t=Alloy.createCollection("updateChecker"),i=Ti.App.Properties.getString("user_id"),o=t.getCheckerById(2,i);o.updated||"",API.callByPost({url:"getItemResponseByUidUrl",params:{last_updated:"",u_id:i}},function(o){var r=Alloy.createCollection("item_response"),a=JSON.parse(o),n=a.data||null;r.saveArray(n),t.updateModule(2,"item_response",Common.now(),i),e&&e()})}function c(){Alloy.createController("_left_right")}function u(){r(),p.start(),s(function(){d(function(){var e=Alloy.createCollection("items");b=e.getData(),L=new A(b.length),L.init(),p.finish()})})}function h(){f.win.add(p.getView()),r(),i();var e=Alloy.createController("_left_right");e.generate_button_old(f.left_right_button)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="home",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var f=this,g={},I={};f.__views.win=Ti.UI.createWindow({backgroundColor:"#ebebeb",titleAttributes:{color:"#ffffff"},navBarHidden:"true",font:{fontFamily:"Lato-Regular"},id:"win",theme:"Theme.NoActionBar",title:"Home",fullscreen:"false"}),f.__views.win&&f.addTopLevelView(f.__views.win),f.__views.__alloyId18=Ti.UI.createView({width:Ti.UI.SIZE,backgroundColor:"orange",id:"__alloyId18"}),f.__views.win.add(f.__views.__alloyId18),f.__views.__alloyId19=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,zIndex:"10",top:"0",backgroundImage:"/images/bg/menu_bar.png",id:"__alloyId19"}),f.__views.__alloyId18.add(f.__views.__alloyId19),f.__views.__alloyId20=Ti.UI.createView({layout:"horizontal",width:Ti.UI.SIZE,height:Ti.UI.SIZE,right:"0",top:"10",id:"__alloyId20"}),f.__views.__alloyId19.add(f.__views.__alloyId20),f.__views.__alloyId21=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:10,controller:"search",height:"40",width:"40",image:"/images/icons/icon_search.png",id:"__alloyId21"}),f.__views.__alloyId20.add(f.__views.__alloyId21),o?f.addListener(f.__views.__alloyId21,"click",o):I["$.__views.__alloyId21!click!navTo"]=!0,f.__views.__alloyId22=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:10,controller:"manage_item",height:"40",width:"40",image:"/images/icons/icon_plus.png",id:"__alloyId22"}),f.__views.__alloyId20.add(f.__views.__alloyId22),o?f.addListener(f.__views.__alloyId22,"click",o):I["$.__views.__alloyId22!click!navTo"]=!0,f.__views.__alloyId23=Ti.UI.createImageView({preventDefaultImage:!0,top:10,left:10,right:10,bottom:10,controller:"setting",height:"40",width:"40",image:"/images/icons/icon_more.png",id:"__alloyId23"}),f.__views.__alloyId20.add(f.__views.__alloyId23),o?f.addListener(f.__views.__alloyId23,"click",o):I["$.__views.__alloyId23!click!navTo"]=!0,f.__views.__alloyId24=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.FILL,top:"60",id:"__alloyId24"}),f.__views.__alloyId18.add(f.__views.__alloyId24),f.__views.__alloyId25=Ti.UI.createView({height:"80",borderColor:"#323136",backgroundColor:"#fff",zIndex:"10",borderRadius:"40",borderWidth:"4",width:"80",right:"10",top:"10",id:"__alloyId25"}),f.__views.__alloyId24.add(f.__views.__alloyId25),f.__views.__alloyId26=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,top:5,left:5,right:5,bottom:5,id:"__alloyId26"}),f.__views.__alloyId25.add(f.__views.__alloyId26),f.__views.__alloyId27=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"POINT",top:"5",textAlign:"center",id:"__alloyId27"}),f.__views.__alloyId26.add(f.__views.__alloyId27),f.__views.point=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:30},id:"point",textAlign:"center"}),f.__views.__alloyId26.add(f.__views.point),f.__views.__alloyId28=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.FILL,top:"0",id:"__alloyId28"}),f.__views.__alloyId24.add(f.__views.__alloyId28),f.__views.item_container=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,id:"item_container",top:"0",zIndex:"10"}),f.__views.__alloyId28.add(f.__views.item_container),f.__views.left_right_button=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,id:"left_right_button",bottom:"0",horizontalWrap:"false",backgroundColor:"#ebebeb"}),f.__views.__alloyId28.add(f.__views.left_right_button),g.destroy=function(){},_.extend(f,f.__views),arguments[0]||{};var p=Alloy.createController("loading"),m=new Date,v=Ti.App.Properties.getString("estimate_time")||m.getTime()/1e3,y=20,w=Ti.Media.createSound({url:"/sound/bloop_x.wav"}),T=Ti.Media.createSound({url:"/sound/game-sound-correct.wav"});Alloy.createCollection("item_response");var A=Alloy.createCollection("items");Alloy.createCollection("message");var E,L,b=A.getData(),U=0,S=0,C=function(e,t,i,o){return{total_sec:60*e+t,timer:this.timer,running:!1,set:function(e,t){return this.total_sec=60*parseInt(e)+parseInt(t),this.time={m:e,s:t},this},start:function(){var e=this;return this.running=!0,this.timer=setInterval(function(){if(e.total_sec){e.total_sec--;var t=parseInt(e.total_sec/60),r=e.total_sec%60;10>t&&(t="0"+t),10>r&&(r="0"+r),e.time={m:t,s:r},i()}else e.stop(),o()},1e3),this},stop:function(){return clearInterval(this.timer),this.running=!1,this.time={m:0,s:0},this.total_sec=0,this}}},A=function(e){return{counter:e,set:function(e){return this.counter=parseInt(e),this},init:function(){if(console.log("total items number: "+this.counter),this.counter)f.item_container.removeAllChildren(),this.insetItem(),this.insetItem();else{var e=f.item_container.rect,t=f.UI.create("ImageView",{width:e.width,height:e.width,backgroundColor:"#75d0cb",image:"/images/default/item.png"});f.item_container.add(t)}return this},insetItem:function(){if(this.counter){var e=Ti.Platform.displayCaps.platformWidth,t=b[this.counter-1],i=f.UI.create("View",{id:t.id,isParent:"yes",top:0,zIndex:this.counter,width:e,labelname:t.item_name,owner_id:t.owner_id,classes:["hsize","vert"]}),o=f.UI.create("Label",{classes:["wfill","hfill","padding"],text:t.item_name,color:"#ffffff"}),r=f.UI.create("View",{top:0,classes:["wfill","shadow"],backgroundColor:"#323136",height:40,zIndex:10}),a=f.UI.create("ImageView",{zIndex:this.counter,width:e,height:"auto",id:t.id,owner_id:t.owner_id,item_name:t.item_name,owner_name:t.owner_name,owner_img_path:t.owner_img_path,image:t.img_path,defaultImage:"/images/default/item.png",zIndex:1});r.add(o),i.add(a),i.add(r),this.counter--,f.item_container.add(i);var s=Alloy.createController("_left_right");s.add_event(i,n,l)}else console.log("no more");return this},ItemRemove:function(e,i){console.log(f.item_container.children.length+" number of children");for(var o=0;o<f.item_container.children.length;o++)console.log(f.item_container.children[o].labelname);console.log(i),console.log(i.labelname),t(i,function(){console.log("removed"),f.item_container.remove(i),console.log(f.item_container.children.length+" number of children")})},displayCurrentItemInfo:function(e){e=e||0;var t=f.item_container.children[e].item_name,i=f.item_container.children[e].owner_name,o=f.item_container.children[e].owner_img_path;f.item_name.text=t,f.owner_name.text=i,f.owner_img_path.image=o},resetCurrentItemInfo:function(){f.item_name.text="",f.owner_name.text="",f.owner_img_path.image=""}}};h(),Ti.App.addEventListener("home:refresh",u),Ti.App.addEventListener("home:leftright_refresh",c),f.win.addEventListener("close",function(){Ti.App.removeEventListener("home:refresh",u),f.destroy()}),I["$.__views.__alloyId21!click!navTo"]&&f.addListener(f.__views.__alloyId21,"click",o),I["$.__views.__alloyId22!click!navTo"]&&f.addListener(f.__views.__alloyId22,"click",o),I["$.__views.__alloyId23!click!navTo"]&&f.addListener(f.__views.__alloyId23,"click",o),_.extend(f,g)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;