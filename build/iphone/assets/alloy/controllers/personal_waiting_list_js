function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(e,t){var i=Titanium.UI.createAnimation({opacity:0,duration:500});e.animate(i),i.addEventListener("complete",function(){console.log("callback from animate"),t&&t()})}function t(){l.ItemRemove(1)}function i(){l.ItemRemove(2)}function o(){r.win.close()}function a(){u.length>0&&(l=new h(u.length),l.init());var e=Alloy.createController("_left_right"),o="Swipe left or right to select";e.generate_button(r.left_right_button,o,t,i),e.generate_indicator(r.indicator)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="personal_waiting_list",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var r=this,n={};r.__views.win=Ti.UI.createWindow({backgroundColor:"#ebebeb",titleAttributes:{color:"#ffffff"},navBarHidden:"false",font:{fontFamily:"Lato-Regular"},layout:"vertical",barColor:"#75d0cb",id:"win",title:"Waiting List"}),r.__views.win&&r.addTopLevelView(r.__views.win),r.__views.__alloyId69=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"0",left:10,right:10,bottom:"0",borderColor:"#a5a5a5",backgroundColor:"#F2F4F5",id:"__alloyId69"}),r.__views.win.add(r.__views.__alloyId69),r.__views.__alloyId70=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId70"}),r.__views.__alloyId69.add(r.__views.__alloyId70),r.__views.__alloyId71=Ti.UI.createView({layout:"horizontal",width:Ti.UI.SIZE,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:"0",borderColor:"#a5a5a5",backgroundColor:"#fff",id:"__alloyId71"}),r.__views.__alloyId70.add(r.__views.__alloyId71),r.__views.__alloyId72=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,top:5,left:5,right:5,bottom:5,width:"70%",id:"__alloyId72"}),r.__views.__alloyId71.add(r.__views.__alloyId72),r.__views.__alloyId73=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"NAME",left:"0",textAlign:"right",id:"__alloyId73"}),r.__views.__alloyId72.add(r.__views.__alloyId73),r.__views.label_field_1=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.FILL,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:24},text:"-",id:"label_field_1",minimumFontSize:"14"}),r.__views.__alloyId72.add(r.__views.label_field_1),r.__views.__alloyId74=Ti.UI.createView({width:"1",height:"50",backgroundColor:"#d2d3ce",id:"__alloyId74"}),r.__views.__alloyId71.add(r.__views.__alloyId74),r.__views.__alloyId75=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,top:5,left:5,right:5,bottom:5,width:"auto",id:"__alloyId75"}),r.__views.__alloyId71.add(r.__views.__alloyId75),r.__views.__alloyId76=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"POINTS",left:"0",textAlign:"right",id:"__alloyId76"}),r.__views.__alloyId75.add(r.__views.__alloyId76),r.__views.label_field_2=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:30},text:"0",id:"label_field_2"}),r.__views.__alloyId75.add(r.__views.label_field_2),r.__views.indicator=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"indicator"}),r.__views.__alloyId69.add(r.__views.indicator),r.__views.label_no_more=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Regular",fontSize:12},text:"No user",id:"label_no_more"}),r.__views.indicator.add(r.__views.label_no_more),r.__views.item_container=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"item_container",left:"10",top:"10",right:"10"}),r.__views.indicator.add(r.__views.item_container),r.__views.left_right_button=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:10,id:"left_right_button"}),r.__views.__alloyId69.add(r.__views.left_right_button),r.__views.__alloyId77=Ti.UI.createImageView({preventDefaultImage:!0,width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"0",left:10,right:10,bottom:10,image:"/images/shadow.png",id:"__alloyId77"}),r.__views.win.add(r.__views.__alloyId77),n.destroy=function(){},_.extend(r,r.__views);var l,s=arguments[0]||{},d=s.id,c=Alloy.createCollection("item_response"),u=c.getData(d);console.log(d),console.log(u);var h=function(t){return{counter:t,set:function(e){return this.counter=parseInt(e),this},init:function(){return this.insetItem(),this.insetItem(),this.displayCurrentItemInfo(),r.item_container.children[0].addEventListener("postlayout",function(){var e=r.item_container.children[0].rect;console.log(e.height+" image height"),r.label_no_more.height=e.height}),this},insetItem:function(){if(console.log("total items number: "+this.counter),this.counter){var e=u[this.counter-1];console.log(e.point+" item point!!");var t=r.UI.create("ImageView",{zIndex:this.counter,classes:["wfill"],height:"auto",id:e.id,point:e.point,item_name:e.item_name,item_img_path:e.item_img_path,requestor_name:e.requestor_name,defaultImage:"/images/default/item.png",image:e.requestor_img_path});this.counter--,r.item_container.add(t)}else console.log("no more");return this},ItemRemove:function(t){1!=r.item_container.children[0].zIndex?this.displayCurrentItemInfo(1):(this.resetCurrentItemInfo(),o()),Ti.App.Properties.getString("user_id");var i=r.item_container.children[0];API.callByPost({url:"updateItemResponseUrl",params:{id:i.id,status:t}},function(e){var t=JSON.parse(e),i=Alloy.createCollection("items");"success"==t.status&&(console.log("work"),console.log(t.data),i.saveRecord(t.data))}),1==t&&Common.createAlert("Notification","User selected.",function(){o()}),e(r.item_container.children[0],function(){console.log("remove "+r.item_container.children[0].id),r.item_container.remove(r.item_container.children[0])})},displayCurrentItemInfo:function(e){e=e||0;var t=r.item_container.children[e].requestor_name,i=r.item_container.children[e].point||0;r.label_field_1.text=t,r.label_field_2.text=i},resetCurrentItemInfo:function(){r.label_field_1.text="",r.label_field_2.text=""}}};a(),r.win.addEventListener("close",function(){r.destroy(),console.log("window close"),Ti.App.fireEvent("personal:refresh")}),_.extend(r,n)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;