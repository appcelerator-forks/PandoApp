function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){c>0&&(c-=1,0==c&&l.hide())}function t(){var e=Titanium.Platform.version.split("."),t=parseInt(e[0],10);return t>=7?!0:!1}function i(e){Ti.API.info("Marking as purchased: "+e),u[e]=!0,Ti.App.Properties.setBool("Purchased-"+e,!0)}function r(){n.win.show()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="Copy of in_app_purchase",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var n=this,s={};s.destroy=function(){},_.extend(n,n.__views),arguments[0]||{};var o=require("ti.storekit");o.receiptVerificationSandbox="production"!==Ti.App.deployType,o.receiptVerificationSharedSecret="<YOUR STOREKIT SHARED SECRET HERE>",o.autoFinishTransactions=!1,o.bundleVersion="1.0",o.bundleIdentifier="com.geonn.pandoapp";var a=!1,l=Ti.UI.createActivityIndicator({bottom:10,height:50,width:50,backgroundColor:"black",borderRadius:10,style:Ti.UI.iPhone.ActivityIndicatorStyle.BIG}),c=0;n.win.add(l);var u={},h=t();o.addEventListener("transactionState",function(t){switch(e(),t.state){case o.TRANSACTION_STATE_FAILED:alert(t.cancelled?"Purchase cancelled":"ERROR: Buying failed! "+t.message),t.transaction&&t.transaction.finish();break;case o.TRANSACTION_STATE_PURCHASED:if(a)if(h){var r=o.validateReceipt()?"Receipt is Valid!":"Receipt is Invalid.";alert(r)}else o.verifyReceipt(t,function(e){e.success?e.valid?(alert("Thanks! Receipt Verified"),i(t.productIdentifier)):alert("Sorry. Receipt is invalid"):alert(e.message)});else alert("Thanks!"),i(t.productIdentifier);t.downloads?o.startDownloads({downloads:t.downloads}):t.transaction&&t.transaction.finish();break;case o.TRANSACTION_STATE_PURCHASING:Ti.API.info("Purchasing "+t.productIdentifier);break;case o.TRANSACTION_STATE_RESTORED:Ti.API.info("Restored "+t.productIdentifier),t.downloads&&Ti.API.info("Downloads available for restored product"),t.transaction&&t.transaction.finish()}}),o.addEventListener("updatedDownloads",function(t){for(var i,r=0,s=t.downloads.length;s>r;r++){switch(i=t.downloads[r],Ti.API.info("Updated: "+i.contentIdentifier+" Progress: "+i.progress),i.downloadState){case o.DOWNLOAD_STATE_FINISHED:case o.DOWNLOAD_STATE_FAILED:case o.DOWNLOAD_STATE_CANCELLED:e()}switch(i.downloadState){case o.DOWNLOAD_STATE_FAILED:case o.DOWNLOAD_STATE_CANCELLED:i.transaction&&i.transaction.finish();break;case o.DOWNLOAD_STATE_FINISHED:var a=Ti.Filesystem.getFile(i.contentURL,"Contents",i.contentIdentifier+".jpeg");if(a.exists()){Ti.API.info("File exists. Displaying it...");var l=Ti.UI.createImageView({bottom:0,left:0,image:a.read()});l.addEventListener("click",function(){n.win.remove(l),l=null}),n.win.add(l)}else Ti.API.error("Downloaded File does not exist at: "+a.nativePath);i.transaction&&i.transaction.finish()}}}),o.addEventListener("restoredCompletedTransactions",function(t){if(e(),t.error)alert(t.error);else if(null==t.transactions||0==t.transactions.length)alert("There were no purchases to restore!");else{h&&a&&(o.validateReceipt()?Ti.API.info("Restored Receipt is Valid!"):Ti.API.error("Restored Receipt is Invalid."));for(var r=0;r<t.transactions.length;r++)!h&&a?o.verifyReceipt(t.transactions[r],function(e){e.valid?i(e.productIdentifier):Ti.API.error("Restored transaction is not valid")}):i(t.transactions[r].productIdentifier);alert("Restored "+t.transactions.length+" purchases!")}}),o.addTransactionObserver(),h&&n.win.addEventListener("postlayout",function(){function e(){Ti.API.info("Validating receipt."),Ti.API.info("Receipt is Valid: "+o.validateReceipt())}o.receiptExists?(Ti.API.info("Receipt does exist."),e()):(Ti.API.info("Receipt does not exist yet. Refreshing to get one."),o.refreshReceipt(null,function(){e()}))}),o.canMakePayments||alert("This device cannot make purchases!"),r(),_.extend(n,s)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;