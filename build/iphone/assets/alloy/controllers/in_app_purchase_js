function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){g+=1,1==g&&f.show()}function t(){g>0&&(g-=1,0==g&&f.hide())}function i(){var e=Titanium.Platform.version.split("."),t=parseInt(e[0],10);return t>=7?!0:!1}function o(e){Ti.API.info("Marking as purchased: "+e),p[e]=!0,Ti.App.Properties.setBool("Purchased-"+e,!0)}function a(e){return Ti.API.info("Checking if purchased: "+e),void 0===p[e]&&(p[e]=Ti.App.Properties.getBool("Purchased-"+e,!1)),p[e]}function r(i,o){e(),u.requestProducts([i],function(e){t(),e.success?e.invalid?alert("ERROR: We requested an invalid product!"):o(e.products[0]):alert("ERROR: We failed to talk to Apple!")})}function n(t){t.downloadable&&Ti.API.info("Purchasing a product that is downloadable"),e(),u.purchase({product:t})}function l(){e(),u.restoreCompletedTransactions()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="in_app_purchase",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var s=this,d={};s.__views.win=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,backgroundImage:"/images/transparent-background.png",id:"win"}),s.__views.win&&s.addTopLevelView(s.__views.win),s.__views.__alloyId38=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,borderColor:"#a5a5a5",backgroundColor:"#ffffff",borderRadius:4,width:"80%",id:"__alloyId38"}),s.__views.win.add(s.__views.__alloyId38),s.__views.__alloyId39=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:24},top:10,left:10,right:10,bottom:10,text:"Get Premium Account",id:"__alloyId39"}),s.__views.__alloyId38.add(s.__views.__alloyId39);var c=[];s.__views.__alloyId42=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId42"}),c.push(s.__views.__alloyId42),s.__views.__alloyId43=Ti.UI.createImageView({preventDefaultImage:!0,image:"/images/no-ads.png",left:"20",right:"20",id:"__alloyId43"}),s.__views.__alloyId42.add(s.__views.__alloyId43),s.__views.__alloyId44=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:18},text:"Turn Off Ads",textAlign:"center",id:"__alloyId44"}),s.__views.__alloyId42.add(s.__views.__alloyId44),s.__views.__alloyId45=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId45"}),c.push(s.__views.__alloyId45),s.__views.__alloyId46=Ti.UI.createImageView({preventDefaultImage:!0,image:"/images/no-ads.png",left:"20",right:"20",id:"__alloyId46"}),s.__views.__alloyId45.add(s.__views.__alloyId46),s.__views.__alloyId47=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:18},text:"Turn Off Ads",textAlign:"center",id:"__alloyId47"}),s.__views.__alloyId45.add(s.__views.__alloyId47),s.__views.__alloyId48=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId48"}),c.push(s.__views.__alloyId48),s.__views.__alloyId49=Ti.UI.createImageView({preventDefaultImage:!0,image:"/images/no-ads.png",left:"20",right:"20",id:"__alloyId49"}),s.__views.__alloyId48.add(s.__views.__alloyId49),s.__views.__alloyId50=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:18},text:"Turn Off Ads",textAlign:"center",id:"__alloyId50"}),s.__views.__alloyId48.add(s.__views.__alloyId50),s.__views.__alloyId40=Ti.UI.createScrollableView({width:Ti.UI.FILL,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:10,views:c,showPagingControl:"true",pagingControlColor:"transparent",id:"__alloyId40"}),s.__views.__alloyId38.add(s.__views.__alloyId40),s.__views.__alloyId51=Ti.UI.createButton({width:Ti.UI.FILL,title:"$0.99 FOR ONE MONTH",backgroundColor:"#75d0cb",height:"40",id:"__alloyId51"}),s.__views.__alloyId38.add(s.__views.__alloyId51),s.__views.__alloyId52=Ti.UI.createButton({width:Ti.UI.FILL,title:"$1.99 FOR ONE YEAR",backgroundColor:"#7fdcd7",height:"40",id:"__alloyId52"}),s.__views.__alloyId38.add(s.__views.__alloyId52),s.__views.__alloyId53=Ti.UI.createButton({width:Ti.UI.FILL,title:"NOT NOW",backgroundColor:"#c2e8e6",height:"40",id:"__alloyId53"}),s.__views.__alloyId38.add(s.__views.__alloyId53),d.destroy=function(){},_.extend(s,s.__views);var u=require("ti.storekit");u.receiptVerificationSandbox="production"!==Ti.App.deployType,u.receiptVerificationSharedSecret="<YOUR STOREKIT SHARED SECRET HERE>",u.autoFinishTransactions=!1,u.bundleVersion="1.0",u.bundleIdentifier="com.geonn.pandoapp";var h=!1,I=Ti.UI.createWindow({backgroundColor:"#fff"}),f=Ti.UI.createActivityIndicator({bottom:10,height:50,width:50,backgroundColor:"black",borderRadius:10,style:Ti.UI.iPhone.ActivityIndicatorStyle.BIG}),g=0;I.add(f);var p={},v=i();if(u.addEventListener("transactionState",function(e){switch(t(),e.state){case u.TRANSACTION_STATE_FAILED:alert(e.cancelled?"Purchase cancelled":"ERROR: Buying failed! "+e.message),e.transaction&&e.transaction.finish();break;case u.TRANSACTION_STATE_PURCHASED:if(h)if(v){var i=u.validateReceipt()?"Receipt is Valid!":"Receipt is Invalid.";alert(i)}else u.verifyReceipt(e,function(t){t.success?t.valid?(alert("Thanks! Receipt Verified"),o(e.productIdentifier)):alert("Sorry. Receipt is invalid"):alert(t.message)});else alert("Thanks!"),o(e.productIdentifier);e.downloads?u.startDownloads({downloads:e.downloads}):e.transaction&&e.transaction.finish();break;case u.TRANSACTION_STATE_PURCHASING:Ti.API.info("Purchasing "+e.productIdentifier);break;case u.TRANSACTION_STATE_RESTORED:Ti.API.info("Restored "+e.productIdentifier),e.downloads&&Ti.API.info("Downloads available for restored product"),e.transaction&&e.transaction.finish()}}),u.addEventListener("updatedDownloads",function(e){for(var i,o=0,a=e.downloads.length;a>o;o++){switch(i=e.downloads[o],Ti.API.info("Updated: "+i.contentIdentifier+" Progress: "+i.progress),i.downloadState){case u.DOWNLOAD_STATE_FINISHED:case u.DOWNLOAD_STATE_FAILED:case u.DOWNLOAD_STATE_CANCELLED:t()}switch(i.downloadState){case u.DOWNLOAD_STATE_FAILED:case u.DOWNLOAD_STATE_CANCELLED:i.transaction&&i.transaction.finish();break;case u.DOWNLOAD_STATE_FINISHED:var r=Ti.Filesystem.getFile(i.contentURL,"Contents",i.contentIdentifier+".jpeg");if(r.exists()){Ti.API.info("File exists. Displaying it...");var n=Ti.UI.createImageView({bottom:0,left:0,image:r.read()});n.addEventListener("click",function(){I.remove(n),n=null}),I.add(n)}else Ti.API.error("Downloaded File does not exist at: "+r.nativePath);i.transaction&&i.transaction.finish()}}}),u.addEventListener("restoredCompletedTransactions",function(e){if(t(),e.error)alert(e.error);else if(null==e.transactions||0==e.transactions.length)alert("There were no purchases to restore!");else{v&&h&&(u.validateReceipt()?Ti.API.info("Restored Receipt is Valid!"):Ti.API.error("Restored Receipt is Invalid."));for(var i=0;i<e.transactions.length;i++)!v&&h?u.verifyReceipt(e.transactions[i],function(e){e.valid?o(e.productIdentifier):Ti.API.error("Restored transaction is not valid")}):o(e.transactions[i].productIdentifier);alert("Restored "+e.transactions.length+" purchases!")}}),u.addTransactionObserver(),v&&I.addEventListener("open",function(){function e(){Ti.API.info("Validating receipt."),Ti.API.info("Receipt is Valid: "+u.validateReceipt())}u.receiptExists?(Ti.API.info("Receipt does exist."),e()):(Ti.API.info("Receipt does not exist yet. Refreshing to get one."),u.refreshReceipt(null,function(){e()}))}),u.canMakePayments){var m=Ti.UI.createButton({title:"What Have I Purchased?",top:10,left:5,right:5,height:40});m.addEventListener("click",function(){alert({"Single Item":a("DigitalSodaPop")?"Purchased!":"Not Yet",Subscription:a("MonthlySodaPop")?"Purchased!":"Not Yet",Downloadable:a("DownloadablePop")?"Purchased!":"Not Yet"})}),I.add(m),r("DigitalSodaPop",function(e){var t=Ti.UI.createButton({title:"Buy "+e.title+", "+e.formattedPrice,top:60,left:5,right:5,height:40});t.addEventListener("click",function(){n(e)}),I.add(t)}),r("MonthlySodaPop",function(e){var t=Ti.UI.createButton({title:"Buy "+e.title+", "+e.formattedPrice,top:110,left:5,right:5,height:40});t.addEventListener("click",function(){n(e)}),I.add(t)}),r("DownloadablePop",function(e){var t=Ti.UI.createButton({title:"Buy "+e.title+", "+e.formattedPrice,top:160,left:5,right:5,height:40});t.addEventListener("click",function(){n(e)}),I.add(t)});var w=Ti.UI.createButton({title:"Restore Lost Purchases",top:210,left:5,right:5,height:40});w.addEventListener("click",function(){l()}),I.add(w);var y=Ti.UI.createView({layout:"horizontal",top:260,left:10,width:"auto",height:"auto"}),T=Ti.UI.createLabel({text:"Verify receipts:",height:Ti.UI.SIZE||"auto",width:Ti.UI.SIZE||"auto"}),A=Ti.UI.createSwitch({value:!1,isSwitch:!0,left:4,height:Ti.UI.SIZE||"auto",width:Ti.UI.SIZE||"auto"});A.addEventListener("change",function(e){h=e.value}),y.add(T),y.add(A),I.add(y)}else alert("This device cannot make purchases!");I.open(),_.extend(s,d)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;