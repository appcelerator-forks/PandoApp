function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){v+=1,1==v&&f.show()}function t(){v>0&&(v-=1,0==v&&f.hide())}function i(){var e=Titanium.Platform.version.split("."),t=parseInt(e[0],10);return t>=7?!0:!1}function o(e){Ti.API.info("Marking as purchased: "+e),m[e]=!0,Ti.App.Properties.setBool("Purchased-"+e,!0)}function a(i,o){e(),I.requestProducts([i],function(e){t(),e.success?e.invalid?alert("ERROR: We requested an invalid product!"):o(e.products[0]):alert("ERROR: We failed to talk to Apple!")})}function r(t){t.downloadable&&Ti.API.info("Purchasing a product that is downloadable"),e(),I.purchase({product:t})}function n(){a("premium_account_tier_1",function(e){var t=Ti.UI.createButton({title:"Buy "+e.title+", "+e.formattedPrice,top:60,left:5,right:5,height:40});t.addEventListener("click",function(){r(e)}),d.win.add(t)})}function l(){d.win.hide()}function s(){d.win.show()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="in_app_purchase",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var d=this,c={},h={};d.__views.win=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,backgroundImage:"/images/transparent-background.png",id:"win"}),d.__views.win&&d.addTopLevelView(d.__views.win),d.__views.__alloyId44=Ti.UI.createView({layout:"vertical",height:Ti.UI.SIZE,borderColor:"#d2d3ce",backgroundColor:"#f6f6f6",borderRadius:4,width:"80%",id:"__alloyId44"}),d.__views.win.add(d.__views.__alloyId44),d.__views.__alloyId45=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:24},top:10,left:10,right:10,bottom:10,text:"Get Premium Account",id:"__alloyId45"}),d.__views.__alloyId44.add(d.__views.__alloyId45);var u=[];d.__views.__alloyId48=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId48"}),u.push(d.__views.__alloyId48),d.__views.__alloyId49=Ti.UI.createImageView({preventDefaultImage:!0,image:"/images/no-ads.png",left:"20",right:"20",id:"__alloyId49"}),d.__views.__alloyId48.add(d.__views.__alloyId49),d.__views.__alloyId50=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:18},text:"Turn Off Ads",textAlign:"center",id:"__alloyId50"}),d.__views.__alloyId48.add(d.__views.__alloyId50),d.__views.__alloyId51=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId51"}),u.push(d.__views.__alloyId51),d.__views.__alloyId52=Ti.UI.createImageView({preventDefaultImage:!0,image:"/images/no-ads.png",left:"20",right:"20",id:"__alloyId52"}),d.__views.__alloyId51.add(d.__views.__alloyId52),d.__views.__alloyId53=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:18},text:"Turn Off Ads",textAlign:"center",id:"__alloyId53"}),d.__views.__alloyId51.add(d.__views.__alloyId53),d.__views.__alloyId54=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId54"}),u.push(d.__views.__alloyId54),d.__views.__alloyId55=Ti.UI.createImageView({preventDefaultImage:!0,image:"/images/no-ads.png",left:"20",right:"20",id:"__alloyId55"}),d.__views.__alloyId54.add(d.__views.__alloyId55),d.__views.__alloyId56=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:18},text:"Turn Off Ads",textAlign:"center",id:"__alloyId56"}),d.__views.__alloyId54.add(d.__views.__alloyId56),d.__views.__alloyId46=Ti.UI.createScrollableView({width:Ti.UI.FILL,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:10,views:u,showPagingControl:"true",pagingControlColor:"transparent",id:"__alloyId46"}),d.__views.__alloyId44.add(d.__views.__alloyId46),d.__views.__alloyId57=Ti.UI.createButton({width:Ti.UI.FILL,title:"$0.99 FOR ONE MONTH",backgroundColor:"#75d0cb",height:"40",id:"__alloyId57"}),d.__views.__alloyId44.add(d.__views.__alloyId57),n?d.addListener(d.__views.__alloyId57,"click",n):h["$.__views.__alloyId57!click!payment_method_1"]=!0,d.__views.__alloyId58=Ti.UI.createButton({width:Ti.UI.FILL,title:"$1.99 FOR ONE YEAR",backgroundColor:"#7fdcd7",height:"40",id:"__alloyId58"}),d.__views.__alloyId44.add(d.__views.__alloyId58),d.__views.__alloyId59=Ti.UI.createButton({width:Ti.UI.FILL,title:"NOT NOW",backgroundColor:"#c2e8e6",height:"40",id:"__alloyId59"}),d.__views.__alloyId44.add(d.__views.__alloyId59),l?d.addListener(d.__views.__alloyId59,"click",l):h["$.__views.__alloyId59!click!closeWindow"]=!0,c.destroy=function(){},_.extend(d,d.__views),arguments[0]||{};var I=require("ti.storekit");I.receiptVerificationSandbox="production"!==Ti.App.deployType,I.receiptVerificationSharedSecret="<YOUR STOREKIT SHARED SECRET HERE>",I.autoFinishTransactions=!1,I.bundleVersion="1.0.0",I.bundleIdentifier="com.geonn.pandoapp";var g=!1,f=Ti.UI.createActivityIndicator({bottom:10,height:50,width:50,backgroundColor:"black",borderRadius:10,style:Ti.UI.iPhone.ActivityIndicatorStyle.BIG}),v=0;d.win.add(f);var m={},p=i();I.addEventListener("transactionState",function(e){switch(t(),e.state){case I.TRANSACTION_STATE_FAILED:alert(e.cancelled?"Purchase cancelled":"ERROR: Buying failed! "+e.message),e.transaction&&e.transaction.finish();break;case I.TRANSACTION_STATE_PURCHASED:if(g)if(p){var i=I.validateReceipt()?"Receipt is Valid!":"Receipt is Invalid.";alert(i)}else I.verifyReceipt(e,function(t){t.success?t.valid?(alert("Thanks! Receipt Verified"),o(e.productIdentifier)):alert("Sorry. Receipt is invalid"):alert(t.message)});else alert("Thanks!"),o(e.productIdentifier);e.downloads?I.startDownloads({downloads:e.downloads}):e.transaction&&e.transaction.finish();break;case I.TRANSACTION_STATE_PURCHASING:Ti.API.info("Purchasing "+e.productIdentifier);break;case I.TRANSACTION_STATE_RESTORED:Ti.API.info("Restored "+e.productIdentifier),e.downloads&&Ti.API.info("Downloads available for restored product"),e.transaction&&e.transaction.finish()}}),I.addEventListener("updatedDownloads",function(e){for(var i,o=0,a=e.downloads.length;a>o;o++){switch(i=e.downloads[o],Ti.API.info("Updated: "+i.contentIdentifier+" Progress: "+i.progress),i.downloadState){case I.DOWNLOAD_STATE_FINISHED:case I.DOWNLOAD_STATE_FAILED:case I.DOWNLOAD_STATE_CANCELLED:t()}switch(i.downloadState){case I.DOWNLOAD_STATE_FAILED:case I.DOWNLOAD_STATE_CANCELLED:i.transaction&&i.transaction.finish();break;case I.DOWNLOAD_STATE_FINISHED:var r=Ti.Filesystem.getFile(i.contentURL,"Contents",i.contentIdentifier+".jpeg");if(r.exists()){Ti.API.info("File exists. Displaying it...");var n=Ti.UI.createImageView({bottom:0,left:0,image:r.read()});n.addEventListener("click",function(){d.win.remove(n),n=null}),d.win.add(n)}else Ti.API.error("Downloaded File does not exist at: "+r.nativePath);i.transaction&&i.transaction.finish()}}}),I.addEventListener("restoredCompletedTransactions",function(e){if(t(),e.error)alert(e.error);else if(null==e.transactions||0==e.transactions.length)alert("There were no purchases to restore!");else{p&&g&&(I.validateReceipt()?Ti.API.info("Restored Receipt is Valid!"):Ti.API.error("Restored Receipt is Invalid."));for(var i=0;i<e.transactions.length;i++)!p&&g?I.verifyReceipt(e.transactions[i],function(e){e.valid?o(e.productIdentifier):Ti.API.error("Restored transaction is not valid")}):o(e.transactions[i].productIdentifier);alert("Restored "+e.transactions.length+" purchases!")}}),I.addTransactionObserver(),p&&d.win.addEventListener("postlayout",function(){function e(){Ti.API.info("Validating receipt."),Ti.API.info("Receipt is Valid: "+I.validateReceipt())}I.receiptExists?(Ti.API.info("Receipt does exist."),e()):(Ti.API.info("Receipt does not exist yet. Refreshing to get one."),I.refreshReceipt(null,function(){e()}))}),I.canMakePayments||alert("This device cannot make purchases!"),s(),h["$.__views.__alloyId57!click!payment_method_1"]&&d.addListener(d.__views.__alloyId57,"click",n),h["$.__views.__alloyId59!click!closeWindow"]&&d.addListener(d.__views.__alloyId59,"click",l),_.extend(d,c)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;