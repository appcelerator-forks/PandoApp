function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){if(console.log(u+" "+p),console.log(h+" "+s.message.value),""!=s.message.value){API.callByPost({url:"sendMessageUrl",params:{to_id:u,item_id:h,u_id:p,message:s.message.value,target:"friends"}});var e={u_id:p,to_id:u,message:s.message.value,type:"text",read:1,item_id:h},t=Alloy.createCollection("message");console.log(e),t.saveRecord(e),s.message.value="",a(),setTimeout(o,1e3)}}function t(){var e=v.owner_id==p?1:0,t=v.code||0;Alloy.Globals.Navigator.open("qr_code",{item_id:h,owner:e,code:t})}function i(){s.item_box.removeAllChildren();var e=s.UI.create("View",{classes:["hsize","wfill","horz"],height:80}),t=s.UI.create("ImageView",{left:10,top:10,width:60,height:"auto",defaultImage:"/images/default/small_item.png",image:v.img_path}),i=s.UI.create("View",{classes:["wfill","hsize","vert","padding"]}),r=s.UI.create("Label",{classes:["h5","wfill","hsize","bold"],textAlign:"left",text:v.item_name});switch(v.status){case 2:var o="Waiting for receive";break;case 5:var o="Item Received"}var a=s.UI.create("Label",{classes:["h5","wfill","hsize"],textAlign:"left",text:o});i.add(r),i.add(a),e.add(t),e.add(i),s.item_box.add(e);var n=s.UI.create("View",{classes:["gray-line"]});s.item_box.add(n)}function r(){s.inner_box.removeAllChildren();for(var e=0;e<data.length;e++){var t=s.UI.create("View",{classes:["hsize","wfill","horz"]}),i=data[e].u_id==p?f:data[e].thumb_path,r=s.UI.create("ImageView",{top:10,width:50,height:"auto",defaultImage:"/images/default/small_item.png",left:10,image:i}),o=s.UI.create("View",{classes:["hsize","vert","box"],top:10,left:10,width:"75%"}),a=s.UI.create("Label",{classes:["h5","wfill","padding"],text:data[e].message}),n=s.UI.create("Label",{classes:["h5","wfill","padding"],top:0,text:data[e].created,textAlign:"right"});o.add(a),o.add(n),data[e].u_id==p?(t.add(o),t.add(r)):(t.add(r),t.add(o)),s.inner_box.add(t)}}function o(){s.chatroom.scrollToBottom()}function a(){g.start(),data=y.getData(h),i(),r(),g.finish()}function n(){s.win.add(g.getView()),a(),s.f_name.text=I[0].fullname}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="conversation",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var s=this,l={},d={};s.__views.win=Ti.UI.createWindow({backgroundColor:"#ebebeb",titleAttributes:{color:"#ffffff"},navBarHidden:"false",font:{fontFamily:"Lato-Regular"},barColor:"#75d0cb",id:"win",title:"Chatroom"}),s.__views.win&&s.addTopLevelView(s.__views.win),s.__views.__alloyId0=Ti.UI.createButton({title:"Code",id:"__alloyId0"}),s.__views.win.rightNavButton=s.__views.__alloyId0,t?s.addListener(s.__views.__alloyId0,"click",t):d["$.__views.__alloyId0!click!onQRCode"]=!0,s.__views.__alloyId1=Ti.UI.createScrollView({width:Ti.UI.FILL,height:Ti.UI.FILL,contentHeight:Ti.UI.FILL,contentWidth:Ti.UI.FILL,id:"__alloyId1"}),s.__views.win.add(s.__views.__alloyId1),s.__views.chatroom=Ti.UI.createScrollView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.FILL,id:"chatroom",bottom:"50",contentHeight:Ti.UI.SIZE,contentWidth:Ti.UI.FILL}),s.__views.__alloyId1.add(s.__views.chatroom),s.__views.__alloyId2=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"__alloyId2"}),s.__views.chatroom.add(s.__views.__alloyId2),s.__views.__alloyId3=Ti.UI.createView({layout:"vertical",width:Ti.UI.SIZE,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:10,id:"__alloyId3"}),s.__views.__alloyId2.add(s.__views.__alloyId3),s.__views.f_name=Ti.UI.createLabel({color:"#2a363a",width:Ti.UI.SIZE,height:Ti.UI.SIZE,font:{fontFamily:"Lato-Light",fontSize:24},id:"f_name"}),s.__views.__alloyId3.add(s.__views.f_name),s.__views.__alloyId4=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,top:"0",left:10,right:10,bottom:10,borderColor:"#a5a5a5",backgroundColor:"#ffffff",id:"__alloyId4"}),s.__views.chatroom.add(s.__views.__alloyId4),s.__views.item_box=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,top:10,left:10,right:10,bottom:"0",backgroundColor:"#F2F4F5",id:"item_box"}),s.__views.__alloyId4.add(s.__views.item_box),s.__views.inner_box=Ti.UI.createView({layout:"vertical",width:Ti.UI.FILL,height:Ti.UI.SIZE,id:"inner_box",top:"0",backgroundColor:"#e5e5e5"}),s.__views.__alloyId4.add(s.__views.inner_box),s.__views.__alloyId5=Ti.UI.createImageView({preventDefaultImage:!0,width:Ti.UI.FILL,height:Ti.UI.SIZE,image:"/images/shadow.png",id:"__alloyId5"}),s.__views.inner_box.add(s.__views.__alloyId5),s.__views.__alloyId6=Ti.UI.createView({layout:"horizontal",width:Ti.UI.FILL,height:Ti.UI.SIZE,backgroundColor:"white",bottom:"0",id:"__alloyId6"}),s.__views.__alloyId1.add(s.__views.__alloyId6),s.__views.message=Ti.UI.createTextField({height:40,borderColor:"#a5a5a5",borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED,verticalAlign:Titanium.UI.TEXT_VERTICAL_ALIGNMENT_CENTER,textAlign:Titanium.UI.TEXT_ALIGNMENT_LEFT,backgroundColor:"#ffffff",width:"70%",left:10,right:10,top:"10",font:{fontFamily:"Lato-Regular"},id:"message",bottom:"10"}),s.__views.__alloyId6.add(s.__views.message),s.__views.__alloyId7=Ti.UI.createButton({borderColor:"#75d0cb",backgroundColor:"#ffffff",color:"#75d0cb",textAlign:Titanium.UI.TEXT_ALIGNMENT_CENTER,width:"60",height:"40",font:{fontSize:14,fontFamily:"Lato-Regular"},title:"Send",right:"10",id:"__alloyId7"}),s.__views.__alloyId6.add(s.__views.__alloyId7),e?s.addListener(s.__views.__alloyId7,"click",e):d["$.__views.__alloyId7!click!SendMessage"]=!0,l.destroy=function(){},_.extend(s,s.__views);var c=arguments[0]||{},u=c.f_id,h=c.id,p=Ti.App.Properties.getString("user_id")||0,f=Ti.App.Properties.getString("thumb_path")||"",g=Alloy.createController("loading"),m=Alloy.createCollection("friends"),I=m.getData(u),T=Alloy.createCollection("items"),v=T.getDataById(h);console.log(v);var y=Alloy.createCollection("message");y.messageRead({item_id:h}),n(),s.chatroom.addEventListener("postlayout",o),Ti.App.addEventListener("conversation:refresh",a),s.win.addEventListener("close",function(){Ti.App.removeEventListener("conversation:refresh",a),Ti.App.fireEvent("friends_items:refresh"),Ti.App.fireEvent("friends:refresh"),Ti.App.fireEvent("personal:refresh"),s.destroy(),console.log("window close")}),d["$.__views.__alloyId0!click!onQRCode"]&&s.addListener(s.__views.__alloyId0,"click",t),d["$.__views.__alloyId7!click!SendMessage"]&&s.addListener(s.__views.__alloyId7,"click",e),_.extend(s,l)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;