var Alloy=require("alloy"),_=require("alloy/underscore")._,model,collection;exports.definition={config:{columns:{id:"INTEGER",fullname:"TEXT",username:"TEXT",mobile:"TEXT",email:"TEXT",img_path:"TEXT",point:"INTEGER"},adapter:{type:"sql",collection_name:"user",idAttribute:"id"}},extendModel:function(e){return _.extend(e.prototype,{}),e},extendCollection:function(e){return _.extend(e.prototype,{getUserById:function(e){var t=this,i="SELECT * FROM "+t.config.adapter.collection_name+" WHERE id='"+e+"'";db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);var a=db.execute(i),o=[];return a.isValidRow()&&(o={id:a.fieldByName("id"),fullname:a.fieldByName("fullname"),username:a.fieldByName("username"),mobile:a.fieldByName("mobile"),email:a.fieldByName("email"),img_path:a.fieldByName("img_path"),point:a.fieldByName("point")}),a.close(),db.close(),t.trigger("sync"),o},getPoint:function(){var e=this,t=Ti.App.Properties.getString("user_id")||0,i="SELECT * FROM "+e.config.adapter.collection_name+" WHERE id=?";db=Ti.Database.open(e.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);var a,o=db.execute(i,t);return o.isValidRow()&&(a=o.fieldByName("point")||0),o.close(),db.close(),e.trigger("sync"),a},saveArray:function(e){var t=this;db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1),db.execute("BEGIN");var i="INSERT OR IGNORE INTO "+t.config.adapter.collection_name+" (id, fullname, username,email,mobile, img_path, point) VALUES (?,?,?,?,?,?,?)";db.execute(i,e.id,e.fullname,e.username,e.email,e.mobile,e.img_path,e.point);var i="UPDATE "+t.config.adapter.collection_name+" SET fullname=?,username=?,email=?,mobile=?,img_path=?,point=? WHERE id=?";db.execute(i,e.fullname,e.username,e.email,e.mobile,e.img_path,e.point,e.id),db.execute("COMMIT"),db.close(),t.trigger("sync")},addColumn:function(e,t){var i=this,a=Ti.Database.open(i.config.adapter.db_name);"android"!=Ti.Platform.osname&&a.file.setRemoteBackup(!1);var o=!1;for(resultSet=a.execute("PRAGMA TABLE_INFO("+i.config.adapter.collection_name+")");resultSet.isValidRow();)resultSet.field(1)==e&&(o=!0),resultSet.next();o||a.execute("ALTER TABLE "+i.config.adapter.collection_name+" ADD COLUMN "+e+" "+t),a.close()}}),e}},model=Alloy.M("user",exports.definition,[]),collection=Alloy.C("user",exports.definition,model),exports.Model=model,exports.Collection=collection;