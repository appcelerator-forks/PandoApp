var Alloy=require("alloy"),_=require("alloy/underscore")._,model,collection;exports.definition={config:{columns:{id:"INTEGER",fullname:"TEXT",username:"TEXT",mobile:"TEXT",email:"TEXT",img_path:"TEXT",point:"INTEGER"},adapter:{type:"sql",collection_name:"user",idAttribute:"id"}},extendModel:function(e){return _.extend(e.prototype,{}),e},extendCollection:function(e){return _.extend(e.prototype,{getUserById:function(e){var t=this,i="SELECT * FROM "+t.config.adapter.collection_name+" WHERE id='"+e+"'";db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);var o=db.execute(i),a=[];return o.isValidRow()&&(a={id:o.fieldByName("id"),fullname:o.fieldByName("fullname"),username:o.fieldByName("username"),mobile:o.fieldByName("mobile"),email:o.fieldByName("email"),img_path:o.fieldByName("img_path"),point:o.fieldByName("point")}),o.close(),db.close(),t.trigger("sync"),a},getPoint:function(){var e=this,t=Ti.App.Properties.getString("user_id")||0,i="SELECT * FROM "+e.config.adapter.collection_name+" WHERE id=?";db=Ti.Database.open(e.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);var o,a=db.execute(i,t);return a.isValidRow()&&(o=a.fieldByName("point")||0),a.close(),db.close(),e.trigger("sync"),o},saveArray:function(e){var t=this;db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1),db.execute("BEGIN");var i="INSERT OR IGNORE INTO "+t.config.adapter.collection_name+" (id, fullname, username,email,mobile, img_path, point) VALUES (?,?,?,?,?,?,?)";db.execute(i,e.id,e.fullname,e.username,e.email,e.mobile,e.img_path,e.point);var i="UPDATE "+t.config.adapter.collection_name+" SET fullname=?,username=?,email=?,mobile=?,img_path=?,point=? WHERE id=?";db.execute(i,e.fullname,e.username,e.email,e.mobile,e.img_path,e.point,e.id),db.execute("COMMIT"),db.close(),t.trigger("sync")},addColumn:function(e,t){var i=this,o=Ti.Database.open(i.config.adapter.db_name);"android"!=Ti.Platform.osname&&o.file.setRemoteBackup(!1);var a=!1;for(resultSet=o.execute("PRAGMA TABLE_INFO("+i.config.adapter.collection_name+")");resultSet.isValidRow();)resultSet.field(1)==e&&(a=!0),resultSet.next();a||o.execute("ALTER TABLE "+i.config.adapter.collection_name+" ADD COLUMN "+e+" "+t),o.close()}}),e}},model=Alloy.M("user",exports.definition,[]),collection=Alloy.C("user",exports.definition,model),exports.Model=model,exports.Collection=collection;