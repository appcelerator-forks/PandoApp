var Alloy=require("alloy"),_=require("alloy/underscore")._,model,collection;exports.definition={config:{columns:{id:"INTEGER PRIMARY KEY",f_id:"INTEGER",u_id:"INTEGER",fullname:"TEXT",username:"TEXT",email:"TEXT",password:"TEXT",mobile:"TEXT",facebook_id:"TEXT",facebook_link:"TEXT",status:"INTEGER",last_login:"TEXT",created:"TEXT",updated:"TEXT",img_path:"TEXT",thumb_path:"TEXT"},adapter:{type:"sql",collection_name:"friends",idAttribute:"id"}},extendModel:function(e){return _.extend(e.prototype,{}),e},extendCollection:function(e){return _.extend(e.prototype,{getData:function(e){var t=this,i=e?" AND f_id="+e:"",o=Ti.App.Properties.getString("user_id"),a="SELECT  friends.*, fm.total FROM "+t.config.adapter.collection_name+" LEFT OUTER JOIN (select count(*) as total, u_id from message where to_id = ? AND read is null group by u_id) as fm on fm.u_id = friends.f_id where friends.u_id = ?"+i;db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);for(var l=db.execute(a,o,o),r=[],n=0;l.isValidRow();)r[n]={id:l.fieldByName("id"),f_id:l.fieldByName("f_id"),u_id:l.fieldByName("u_id"),fullname:l.fieldByName("fullname"),username:l.fieldByName("username"),email:l.fieldByName("email"),password:l.fieldByName("password"),mobile:l.fieldByName("mobile"),facebook_id:l.fieldByName("facebook_id"),facebook_link:l.fieldByName("facebook_link"),status:l.fieldByName("status"),last_login:l.fieldByName("last_login"),created:l.fieldByName("created"),updated:l.fieldByName("updated"),img_path:l.fieldByName("img_path"),total:l.fieldByName("total"),thumb_path:l.fieldByName("thumb_path")},l.next(),n++;return l.close(),db.close(),t.trigger("sync"),r},saveArray:function(e){var t=this;db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1),db.execute("BEGIN"),e.forEach(function(e){var i="INSERT OR IGNORE INTO "+t.config.adapter.collection_name+" (id, f_id, u_id, fullname, username, email, password, mobile, facebook_id, facebook_link, status, last_login, created, updated, img_path, thumb_path) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";db.execute(i,e.id,e.f_id,e.u_id,e.fullname,e.username,e.email,e.password,e.mobile,e.facebook_id,e.facebook_link,e.status,e.last_login,e.created,e.updated,e.img_path,e.thumb_path);var i="UPDATE "+t.config.adapter.collection_name+" SET f_id=?, u_id=?, fullname=?, username=?, email=?, password=?, mobile=?, facebook_id=?, facebook_link=?, status=?, last_login=?, created=?, updated=?, img_path=?, thumb_path=? WHERE id=?";db.execute(i,e.f_id,e.u_id,e.fullname,e.username,e.email,e.password,e.mobile,e.facebook_id,e.facebook_link,e.status,e.last_login,e.created,e.updated,e.img_path,e.thumb_path,e.id)}),console.log(db.getRowsAffected()+"insert into friend 1"),db.execute("COMMIT"),db.close(),t.trigger("sync")},saveRecord:function(e){var t=this;db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);var i="INSERT OR IGNORE INTO "+t.config.adapter.collection_name+" (id, f_id, u_id, fullname, username, email, password, mobile, facebook_id, facebook_link, status, last_login, created, updated, img_path, thumb_path) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";db.execute(i,e.id,e.f_id,e.u_id,e.fullname,e.username,e.email,e.password,e.mobile,e.facebook_id,e.facebook_link,e.status,e.last_login,e.created,e.updated,e.img_path,e.thumb_path);var i="UPDATE "+t.config.adapter.collection_name+" SET f_id=?, u_id=?, fullname=?, username=?, email=?, password=?, mobile=?, facebook_id=?, facebook_link=?, status=?, last_login=?, created=?, updated=?, img_path=?, thumb_path=? WHERE id=?";db.execute(i,e.f_id,e.u_id,e.fullname,e.username,e.email,e.password,e.mobile,e.facebook_id,e.facebook_link,e.status,e.last_login,e.created,e.updated,e.img_path,e.thumb_path,e.id),console.log(db.getRowsAffected+"insert into item response"),db.close(),t.trigger("sync")},addColumn:function(e,t){var i=this,o=Ti.Database.open(i.config.adapter.db_name);"android"!=Ti.Platform.osname&&o.file.setRemoteBackup(!1);var a=!1;for(resultSet=o.execute("PRAGMA TABLE_INFO("+i.config.adapter.collection_name+")");resultSet.isValidRow();)resultSet.field(1)==e&&(a=!0),resultSet.next();a||o.execute("ALTER TABLE "+i.config.adapter.collection_name+" ADD COLUMN "+e+" "+t),o.close()}}),e}},model=Alloy.M("friends",exports.definition,[]),collection=Alloy.C("friends",exports.definition,model),exports.Model=model,exports.Collection=collection;