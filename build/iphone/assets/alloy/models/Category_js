var Alloy=require("alloy"),_=require("alloy/underscore")._,model,collection;exports.definition={config:{columns:{c_id:"INTEGER PRIMARY KEY",c_name:"TEXT",c_level:"INTEGER",c_parent:"INTEGER",status:"INTEGET",img_path:"TEXT"},adapter:{type:"sql",collection_name:"category",idAttribute:"c_id"}},extendModel:function(e){return _.extend(e.prototype,{}),e},extendCollection:function(e){return _.extend(e.prototype,{getData:function(){var e=this;Ti.App.Properties.getString("user_id");var t="SELECT * FROM "+e.config.adapter.collection_name+" where c_parent = 0 ";db=Ti.Database.open(e.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);for(var i=db.execute(t),o=[],a=0;i.isValidRow();)o[a]={c_id:i.fieldByName("c_id"),c_name:i.fieldByName("c_name"),c_level:i.fieldByName("c_level"),c_parent:i.fieldByName("c_parent"),status:i.fieldByName("status"),img_path:i.fieldByName("img_path")},i.next(),a++;return i.close(),db.close(),e.trigger("sync"),o},saveArray:function(e){var t=this;db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1),db.execute("BEGIN"),e.forEach(function(e){var i="INSERT OR IGNORE INTO "+t.config.adapter.collection_name+" (c_id, c_name, c_level, c_parent, status, img_path) VALUES (?,?,?,?,?,?)";db.execute(i,e.c_id,e.c_name,e.c_level,e.c_parent,1,"");var i="UPDATE "+t.config.adapter.collection_name+" SET c_name=?, c_level=?, c_parent=?, status=?, img_path=? WHERE c_id=?";db.execute(i,e.c_name,e.c_level,e.c_parent,1,"",e.c_id)}),console.log(db.getRowsAffected()+"insert into item response 1"),db.execute("COMMIT"),console.log(db.getRowsAffected()+"insert into item response 2"),db.close(),t.trigger("sync")},saveRecord:function(e){var t=this;db=Ti.Database.open(t.config.adapter.db_name),"android"!=Ti.Platform.osname&&db.file.setRemoteBackup(!1);var i="INSERT OR IGNORE INTO "+t.config.adapter.collection_name+" (c_id, c_name, c_level, c_parent, status, img_path) VALUES (?,?,?,?,?,?)";db.execute(i,e.c_id,e.c_name,e.c_level,e.c_parent,1,"");var i="UPDATE "+t.config.adapter.collection_name+" SET c_name=?, c_level=?, c_parent=?, status=?, img_path=? WHERE c_id=?";db.execute(i,e.c_name,e.c_level,e.c_parent,e.status,"",e.c_id),console.log(db.getRowsAffected+"insert into item response"),db.close(),t.trigger("sync")},addColumn:function(e,t){var i=this,o=Ti.Database.open(i.config.adapter.db_name);"android"!=Ti.Platform.osname&&o.file.setRemoteBackup(!1);var a=!1;for(resultSet=o.execute("PRAGMA TABLE_INFO("+i.config.adapter.collection_name+")");resultSet.isValidRow();)resultSet.field(1)==e&&(a=!0),resultSet.next();a||o.execute("ALTER TABLE "+i.config.adapter.collection_name+" ADD COLUMN "+e+" "+t),o.close()}}),e}},model=Alloy.M("category",exports.definition,[]),collection=Alloy.C("category",exports.definition,model),exports.Model=model,exports.Collection=collection;