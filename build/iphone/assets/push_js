function getNotificationNumber(e){console.log(e)}function receivePush(e){console.log(e),console.log("receive push");var t,i;if("friends"==e.data.target){var t={u_id:e.data.f_id,to_id:e.data.u_id,message:e.data.alert,item_id:e.data.item_id,type:"text"},i=Alloy.createCollection("message");console.log(redirect+" want to see true or false"),i.saveRecord(t),redirect?(Alloy.Globals.Navigator.open("friends"),Alloy.Globals.Navigator.open("friends_items",{f_id:e.data.f_id}),Alloy.Globals.Navigator.open("conversation",{f_id:e.data.f_id,id:e.data.item_id})):(Ti.App.fireEvent("friends:refresh"),Ti.App.fireEvent("conversation:refresh"))}else"pairing_success"==e.data.target&&(redirect?(Alloy.Globals.Navigator.open("friends"),Alloy.Globals.Navigator.open("friends_items",{f_id:e.data.f_id}),Alloy.Globals.Navigator.open("conversation",{f_id:e.data.f_id,id:e.data.item_id})):(Common.createAlert("Notification","Item pairing is successful."),Ti.App.fireEvent("friends:refresh"),Ti.App.fireEvent("conversation:refresh")));return!1}function deviceTokenSuccess(e){deviceToken=e.deviceToken,Cloud.Users.login({login:"pando",password:"123456"},function(e){e.success&&Cloud.PushNotifications.subscribe({channel:"general",type:"ios",device_token:deviceToken},function(e){console.log(e),e.success?(console.log(deviceToken+"push"),Ti.App.Properties.setString("deviceToken",deviceToken),API.updateNotificationToken()):registerPush()})})}function deviceTokenError(e){alert("Failed to register for push notifications! "+e.error)}function registerPush(){parseInt(Ti.Platform.version.split(".")[0])>=8?(Ti.App.iOS.addEventListener("usernotificationsettings",function e(){Ti.App.iOS.removeEventListener("usernotificationsettings",e),Ti.Network.registerForPushNotifications({success:deviceTokenSuccess,error:deviceTokenError,callback:receivePush})}),Ti.App.iOS.registerUserNotificationSettings({types:[Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT,Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND,Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE]})):"android"==Ti.Platform.osname?CloudPush.retrieveDeviceToken({success:deviceTokenSuccess,error:deviceTokenError}):Titanium.Network.registerForPushNotifications({types:[Titanium.Network.NOTIFICATION_TYPE_BADGE,Titanium.Network.NOTIFICATION_TYPE_ALERT,Titanium.Network.NOTIFICATION_TYPE_SOUND],success:deviceTokenSuccess,error:deviceTokenError,callback:receivePush})}var Cloud=require("ti.cloud"),redirect=!0,app_status;if("android"==Ti.Platform.osname){var CloudPush=require("ti.cloudpush");CloudPush.addEventListener("callback",function(e){var t=JSON.parse(e.payload);Ti.App.Payload=t,console.log("callback push"),redirect?("not_running"==app_status||(redirect=!1,getNotificationNumber(t)),receivePush(t)):receivePush(t)}),CloudPush.addEventListener("trayClickLaunchedApp",function(e){var t=JSON.parse(e.payload);redirect=!0,receivePush(t),console.log("Tray Click Launched App (app was not running)"),app_status="not_running"}),CloudPush.addEventListener("trayClickFocusedApp",function(e){redirect=!1;var t=JSON.parse(e.payload);console.log("Tray Click Focused App (app was already running)"),receivePush(t),app_status="running"})}Ti.App.addEventListener("pause",function(){console.log("sleep"),redirect=!0}),Ti.App.addEventListener("resumed",function(){console.log("resume"),redirect=!1}),exports.setInApp=function(){console.log("In App"),redirect=!1},exports.registerPush=function(){Titanium.UI.iPhone.setAppBadge("0"),registerPush()};